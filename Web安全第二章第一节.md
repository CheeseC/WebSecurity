# Web安全第二章第一节 常见的安全事件
> 2018年4月19日 杭州

## Web开发的基础知识
&nbsp;&nbsp;这里提一下关于Web开发的基础知识，对于做Web安全的了解和熟悉Web开发是做好一个好的安全工程师的前提。Web开发主要分为前后端，前端技术js+html+css,服务器端可以选择一种语言php、node、python、java、.net等等。网上对于这方面介绍的资料也非常丰富。

## 洲际酒店(IHG)集团旗下12家酒店遭遇大规模数据泄露
黑客利用恶意软件入侵了洲际酒店集团12家酒店的支付系统并窃取了信用卡信息。

酒店业巨头洲际酒店集团(IHG)确认旗下12家酒店的支付系统遭到入侵，成为大规模数据泄露的受害者。仅在一月前，IHG公司曾证实旗下部分酒店的信用卡支付存在问题，公司正在对此进行调查。

![洲际酒店(IHG)集团旗下12家酒店遭遇大规模数据泄露](http://s2.51cto.com/oss/201712/20/75c9e3f73ab38aeac98fdc3eb812d9b2.jpg-wh_651x-s_2251719815.jpg)

洲际酒店集团通知客户：凡是在2016年8月至12月期间在这12家酒店的餐厅或者酒吧使用信用卡支付的客户都成为了此次数据泄露的受害人。

遭遇入侵和信用卡数据泄露的12所酒店包括：
+ 旧金山洲际酒店(InterContinental San Francisco )
+ 阿鲁巴岛假日酒店(Holiday Inn Resort – Aruba)
+ 芝加哥华丽一英里洲际酒店(InterContinental Chicago Magnificent Mile)
+ 圣何塞谷皇冠假日酒店(Crowne Plaza San Jose-Silicon Valley)
+ 旧金山渔人码头假日酒店(Holiday Inn San Francisco Fisherman’s Wharf)
+ 洛杉矶世纪城洲际酒店(InterContinental Los Angeles Century City)
+ Mark Hopkins洲际酒店(InterContinental Mark Hopkins)
+ 亚特兰大Buckhead洲际酒店(InterContinental Buckhead Atlanta)
+ Willard洲际酒店(InterContinental The Willard)
+ 多伦多Yorkville洲际酒店(InterContinental Toronto Yorkville)
+ 圣胡安洲际度假酒店和赌场(InterContinental San Juan Resort & Casino)
+ Nashville机场假日酒店(Holiday Inn Nashville Airport)

攻击者使用恶意软件感染了这些酒店的支付系统，窃取的数据包括：持卡人姓名、卡号、信用卡过期时间和内部验证代码。

“IHG雇佣了顶级网络安全公司来检查整个美洲地区酒店的信用卡支付系统。基于此次调查，IHG先通知了在2016年8月至12月期间在这12家酒店的餐厅或者酒吧使用信用卡支付的客户，同时针对该集团其他区域酒店的调查也在持续进行中。”——IHG官方声明

IHG还提到，只有在这12家酒店的餐厅或者酒吧使用信用卡的用户遭到数据泄露，在酒店前台使用信用卡的用户则逃过一劫。

IHG将此次事件上报执法机关，并和支付网络合作允许银行来监控欺诈交易。截至目前，还未有具体遭到数据泄露影响的用户数量。IHG成立了专门的呼叫中心来为客户答疑解惑，想要了解更多的数据泄露信息可以访问以下网站：[www.ihg.com/protectingourguests](www.ihg.com/protectingourguests)。

4月更新：

洲际再遭黑客攻击 超过1000家酒店客户支付数据泄露

洲际酒店集团(IHG)在4月份发布了一份声明，详细说明了IHG在其系统中发现了恶意软件。该恶意软件从信用卡磁条中读取记录数据，包括信用卡号码、有效期、内部验证码，有些情况下还包括持卡人姓名。受影响的酒店位于美国和波多黎各，数量超过1000 家。

## 58同城被曝简历数据泄露:700元可采集全国简历信息

58同城的全国简历数据泄露了。

近日，记者调查发现，有淘宝电商出售“58同城简历数据”。其中一位旺旺号为“lsgjart”的店铺告诉记者：“一次购买2万份以上，3毛一条;10万以上，2毛一条。要多少有多少，全国同步实时更新。”根据该店主发来的少量简历信息测试，记者电话联系的求职者均在58同城上投递了简历，有人还在当天更新过自己的简历。

当然，出售数据者并非独此一家。另一家店铺按照2毛一条出售数据，并且在记者多次沟通下表示：“700块卖你一套软件，你可以自己采集58数据。”并非店主慷慨，而是“这个软件已经快烂大街了，有几个团队开发过针对58的采集软件，更新过几次版本，已经稳定运行了几个月了，现在手里有软件的人不在少数。”

![58同城被曝简历数据泄露:700元可采集全国简历信息](http://s3.51cto.com/oss/201712/19/ba62822cff7179e1f1ddbeaef02b3b35.jpg-wh_651x-s_2012654642.jpg)

20元/份简历变廉价批发

3月20日，支付700元购买软件之后，记者用卖家提供的账号登录软件，在检索选项中选择北京市、所有职业、2017年1月后更新过简历的活跃求职者，该软件开始不断采集信息，并且将所采集信息按照“姓名、手机号、求职方向、年龄、期望月薪、工作经验、居住地、学历、用户ID、更新简历时间”等格式自动录入到excel表格中。

在检索选项中，包括全国430多个城市，以及464个职业选项。该登录账号有效期为1个月，如果需要不断获取58简历最新数据，每个月都需要续费700元。

21世纪经济报道记者在几个小时内按照上述条件采集到约3万条数据，根据该软件每小时可以采集数千份数据，卖家告诉记者：“软件对每个人的采集速度做出限制，采集的人太多，如果数据流太大，有可能会被58发现。但已经做好防御措施，放心用你的，不会被封。”

此外，卖家建议记者，如果想提高检索速度，可以购买ADSL服务器，该服务器可以通过不断更换IP的方式躲避58的监测，“一般采集量大的都会买这个。”

从采集结果中，记者联系了数位在3月20日更新简历的求职者，后者向记者确认“今天更新了简历，并且投递过简历”。

需要指出，58同城官网本身并未对求职者简历做出太多保护措施。在58同城官网上注册的账号均可搜索所有人简历，并查看年龄、头像、学历、学校等信息，但不能查看手机号。

如果需要查看求职者联系方式，则需要获取权限，向58“购买简历套餐”。根据官网信息，简历套餐分为5档，最便宜的一档仅可以查看6份简历，每份20元，总价120元。最高档每份简历售价14.5元，可以查看138份，总价2000元。

日前，58同城发布财报，预计58同城将在2017年底成为中国最大的网络招聘公司，并且预计招聘业务将在2017年增长50%左右，成为58集团旗下最大的业务。但如今，简历数据库出现泄密情况，原本高价出售的简历信息现在均可廉价获取。

目前，并不确定此类泄密事件对58影响几何，但如果信息广泛流通，一旦被诈骗分子利用，就可以根据求职者的求职意向、更新简历频率、年龄、学校定制诈骗内容。2015年至今，多地公安机关发布公告，提醒求职者警惕招聘诈骗。

值得一提的是，在淘宝宝贝搜索栏中输入“58简历”，搜索框下拉栏中会推荐“58简历电话查看”、“58简历采集工具”等关键词，但是直接键入此类关键词却没有对应结果。知情人士介绍：“说明淘宝上热卖过这类产品，但后来被清理掉了。”

3月23日，记者就“有淘宝卖家大量出售58同城简历”、“简历数据泄露”等问题咨询58同城相关部门人士。58同城回应记者称：“58同城通过技术手段将求职者进行加密，除正常渠道下载外，58内部员工也无法查看简历电话号码”，“58同城通过技术手段禁止了网络爬虫对58同城简历内容的抓取”，此外，58同城正在通过多种风控措施进一步保护求职者信息。

恶意爬虫+移动端漏洞

不过，事实与58同城的回应略有出入。

3月23日，记者将该软件以及信息泄露情况提供给多家安全机构，包括猎豹移动、安华金和等安全公司均告诉21世纪经济报道记者：“这个采集软件，是一个恶意爬虫工具。”爬虫软件是一种收集大量信息时的常用软件，而利用漏洞爬取信息则被称为恶意爬虫。

招聘网站允许企业、个人账号搜索简历，是爬虫软件可以采集简历信息的入口。包括58同城、智联招聘、前程无忧等大型招聘网站均提供简历搜索权限，搜索结果呈现大部分个人信息，但查看联系方式则需要向网站付费。

安华金和安全攻防实验室专家告诉记者，“涉及个人隐私的信息，应当防范爬虫软件。”该人士告诉记者，名为集搜客(GooSeeKer)的平台提供了大量爬取58信息的爬虫软件。记者在GooSeeKer发现，多个爬取58本地商户信息、汽车过户联系人信息、保洁公司信息、租房联系人信息的爬虫软件在售。

目前，开始考虑隐私保护的平台已经不再提供简历搜索服务。面向数百万学生实习群体的“实习僧”CTO王承明告诉21世纪经济报道记者：“给企业或者合作商开放权限过大，容易导致信息爬取。‘实习僧’杜绝企业直接搜索简历，企业下载简历的路径也都是动态随机生成，这样避免过度传播。”

理论上，爬虫软件只能爬取到部分简历信息。在招聘网站设置了联系方式的阅读权限之后，爬虫软件并不能爬取其联系方式信息。但遗憾的是，“58同城存在多个安全技术漏洞的组合”，“白帽汇”创始人赵武告诉记者，一是58同城在移动端的一个接口导致可以批量获取用户的简历ID，以及加密不严谨的用户ID信息，二是另一个接口导致用户包括姓名等真实信息泄漏;三是58的微店程序能够通过用户ID获取用户的电话号码，“其实这几个漏洞任何一个都算不上是高危漏洞，但是在多个漏洞的组合情况下，就会造成大范围的数据泄漏，可能被黑产用于电信欺诈等破坏性攻击。”

记者截稿时，白帽汇已经复现了数据泄露的整个过程，并将漏洞整理向监管部门报备。

需要指出，该漏洞或许已经存在很长时间。在精易论坛、52破解等汇集了软件开发者的论坛中，58同城简历采集工具、漏洞分析等相关文章从2016年初就开始不断出现，还有不少开发者推广自己开发的58简历采集工具。

目前，招聘行业普遍存在信息泄露风险。一位曾在智联工作人士告诉记者：“内部对于信息保护并不严格，新来的实习生也可以跟主管要个账号，登录数据库把求职者简历下载到个人电脑上，想下多少都可以，没有限制。”

除此之外，有多个卖家在淘宝出售智联招聘企业账号，其中一个店主告诉记者：“一个账号900元，可以下载200份简历。”该价格远低于官方价格，根据一企业提供的智联招聘合同显示，“一个可以下载200份简历的账号，一年3200元。”此外，前程无忧、猎聘网企业账号也均有出售，均可下载简历。

## 6月1日“网络安全法”实施！3分钟看明白对你我的影响
6月1日，《中华人民共和国网络安全法》正式实施。这是我国网络领域的基础性法律，明确加强了对个人信息的保护，对网络诈骗的打击，并将加强惩治破坏我国关键信息基础设施的境外组织和个人。

![6月1日“网络安全法”实施！3分钟看明白对你我的影响](http://s5.51cto.com/wyfs02/M00/97/64/wKioL1kuMnXgubDkAAJGBOBNnNQ722.jpg-wh_651x-s_3084695567.jpg)

**与我们工作和生活密切相关的条文**

1. 网络安全企业和机构获得更多支持，这将促进行业和企业做大：第十四条 国务院和省、自治区、直辖市人民政府应当统筹规划，加大投入，扶持重点网络安全技术产业和项目，支持网络安全技术的研究开发、应用和推广，保护网络技术知识产权，支持科研机构、高等院校和企业参与国家网络安全技术创新项目。

2. 加强网络安全教育和知识普及，让更多了解网络安全的作用，这样才能做好安全的防范：第十五条 各级人民政府及其有关部门应当组织开展经常性的网络安全宣传教育，并指导、督促有关单位做好网络安全宣传教育工作。大众传播媒介应当有针对性地面向社会进行网络安全宣传教育。

3. 推动网络安全类教育机构发展，培养更多网络安全人才：第十六条 国家支持企业和高等院校、职业学校等教育培训机构开展网络安全相关教育与培训，采取多种方式培养网络安全技术人才，促进网络安全技术人才交流。

4. 对网络安全运维岗位提出了具体规范和要求，网管岗位很重要，责任也很重大：第十七条 国家实行网络安全等级保护制度。网络运营者应当按照网络安全等级保护制度的要求，履行下列安全保护义务，保障网络免受干扰、破坏或者未经授权的访问，防止网络数据泄露或者被窃取、篡改。

5. 网络安全提供者有保护企业、个人网络安全的义务，不得推卸责任：第十八条 网络产品、服务应当符合相关国家标准、行业标准。网络产品、服务的提供者不得设置恶意程序;其产品、服务具有收集用户信息功能的，应当向用户明示并取得同意;发现其网络产品、服务存在安全缺陷、漏洞等风险时，应当及时向用户告知并采取补救措施。网络产品、服务的提供者应当为其产品、服务持续提供安全维护;在规定或者当事人约定的期间内，不得终止提供安全维护。

6. 网络服务的提供者必须建立网络危机应对预案，不能出现问题就推卸给第三方：第二十一条 网络运营者应当制定网络安全事件应急预案，及时处置系统漏洞、计算机病毒、网络入侵、网络攻击等安全风险;在发生危害网络安全的事件时，立即启动应急预案，采取相应的补救措施，并按照规定向有关主管部门报告。

7. 明确对网络犯罪范畴，网络劫持、伪基站、诱导输入以及以为违法行为提供广告和支付等后台支持也将受处罚：第二十二条 任何个人和组织不得从事入侵他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动;不得提供从事入侵网络、干扰网络正常功能、窃取网络数据等危害网络安全活动的工具和制作方法;不得为他人实施危害网络安全的活动提供技术支持、广告推广、支付结算等帮助。

8. 安全信息共享，各企业和部门形成连通，大数据将有更多覆盖：第二十四条国家支持网络运营者之间开展网络安全信息收集、分析、通报和应急处置等方面的合作，提高网络运营者的安全保障能力。

9. 强调电信运营商的安全责任：第二十九条关键信息基础设施的运营者采购网络产品和服务，应当与提供者签订安全保密协议，明确安全和保密义务与责任。

![6月1日“网络安全法”实施！3分钟看明白对你我的影响](http://s3.51cto.com/wyfs02/M01/97/63/wKiom1kuMoHjzmvxAAG9ao-f4W4309.jpg)

10. 要求网络服务提供商必须保障个人信息安全，不得违规收集存储、随意转卖和商用，更不得造成信息泄露丢失等，而个人也有权利要求网络服务提供商删除自己的信息。如果发现个人信息被非法收集利用，可以向主管部门举报，甚至诉诸法律：第三十五条 网络运营者收集、使用公民个人信息，应当遵循合法、正当、必要的原则，明示收集、使用信息的目的、方式和范围，并经被收集者同意。网络运营者不得收集与其提供的服务无关的公民个人信息，不得违反法律、行政法规的规定和双方的约定收集、使用公民个人信息，并应当依照法律、行政法规的规定或者与用户的约定，处理其保存的公民个人信息。网络运营者收集、使用公民个人信息，应当公开其收集、使用规则。

第三十六条 网络运营者对其收集的公民个人信息必须严格保密，不得泄露、篡改、毁损，不得出售或者非法向他人提供。网络运营者应当采取技术措施和其他必要措施，确保公民个人信息安全，防止其收集的公民个人信息泄露、毁损、丢失。在发生或者可能发生信息泄露、毁损、丢失的情况时，应当立即采取补救措施，告知可能受到影响的用户，并按照规定向有关主管部门报告。——在个人信息安全方面，对网络提供者提出了严格要求。

第三十七条 公民发现网络运营者违反法律、行政法规的规定或者双方的约定收集、使用其个人信息的，有权要求网络运营者删除其个人信息;发现网络运营者收集、存储的其个人信息有错误的，有权要求网络运营者予以更正。

第三十八条 任何个人和组织不得窃取或者以其他非法方式获取公民个人信息，不得出售或者非法向他人提供公民个人信息。

11. 强调防止内部泄密的重要性，毕竟很多信息泄露是内部人员所为：第三十九条 依法负有网络安全监督管理职责的部门，必须对在履行职责中知悉的公民个人信息、隐私和商业秘密严格保密，不得泄露、出售或者非法向他人提供。

网络安全顶层设计大事记

从2014年开始，国家就加强了对网络安全的立法和顶层设计。

2014年2月，国家成立“中央网络安全和信息化领导小组”，统筹国家优势资源统一设计我国网络安全制度。习总书记在中央网络安全和信息化领导小组第一次会议上提出“没有网络安全就没有国家安全”，“没有信息化就没有现代化”的重要论断，由此开启了我国网络空间安全治理的顶层设计，网络安全被提升至国家安全战略的新高度。

2016年4月19日，习总书记在网络安全和信息化工作座谈会上发表重要讲话，提出要“坚持政策引导和依法管理并举”，“加快网络立法进程，完善依法监管措施，化解网络风险”。为构建网络安全法律保障机制指明了方向，拓展了建设网络强国、提升网络空间国际治理能力的路径，是我国网络安全战略、顶层法律制度和具体规章制定的驱动力和催化剂。

2016年11月7日，十二届全国人大常委会第二十四次会议表决，通过了《中华人民共和国网络安全法》，法律进一步界定关键信息基础设施范围，对攻击、破坏我国关键信息基础设施的境外组织和个人规定相应的惩治措施，增加惩治网络诈骗等新型网络违法犯罪活动的规定等。

2017年5月9日，最高人民法院、最高人民检察院公布了《关于办理侵犯公民个人信息刑事案件适用法律若干问题的解释》。《解释》中将公民个人信息分为敏感信息、重要信息和普通信息，如果侵犯公民个人信息数量分别达到50条、500条、5000条的标准，则可能构成犯罪。对于“内部人”犯罪，则规定“减半计算”的从重打击。

2017年6月1日，《中华人民共和国网络安全法》正式实施。


## 常见的安全事件
+ 暴力破解
+ 命令注入
+ 跨站伪装
+ 文件包含
+ 文件上传
+ 非安全验证
+ Sql注入
+ Sql盲注
+ 弱Session ID
+ 跨站脚本攻击(DOM)
+ 跨站脚本攻击(反射)
+ 跨站脚本攻击(存储)

### 笔记
**无处不在的安全问题**
* “钓鱼”：利用各种手段，仿冒真实网站的URL地址以及页面内容，或利用真实网站服务器程序上的漏洞在站点的某些网页中插入危险的HTML代码，以此来骗取用户银行或信用卡账号、密码等私人资料。

* “篡改”网页：谷歌搜索intitle:hacked by可以搜索出曾经被黑过的网站，搜索引擎语法还有：Intext/Site等

* “暗链”：一种是你主动隐藏于别人网站的链接，或许你是做网站的，或许你曾经拥有某个网站的后台，能够添加上去（提高SEO）；还有一种情况是别人盗取你的模版，但是上面存在很多你的绝对地址，这样就导致了暗链。

* “webshell”：以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，然后就可以使用浏览器来访问asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的。webshell可以穿越服务器防火墙，由于与被控制的服务器或远程过80端口传递的，因此不会被防火墙拦截。并且使用webshell一般不会在系统日志中留下记录，只会在网站的web日志中留下一些数据提交记录，没有经验的管理员是很难看出入侵痕迹的。


**常见web漏洞解析**
这里只要简要介绍一些这些概念，具体的原理，案例，防御手段，会在后续中详细说明。

***XSS***

Cross Site Script：跨站脚本攻击

攻击者向有XSS漏洞的网站中输入(传入)恶意的HTML代码，当其它用户浏览该网站时，这段HTML代码会自动执行，从而达到攻击的目的。如，盗取用户Cookie、破坏页面结构、重定向到其它网站等。理论上，所有可输入的地方没有对输入数据进行处理的话，都会存在XSS漏洞。

* 存储型：持久化，代码是存储在服务器中的，例如黑客提交了一篇带恶意脚本的博客，过滤不严时被存储在服务器中，当其它用户访问时，就会触发脚本，执行恶意操作。受害者较广。

* 反射型：非持久化，需要欺骗用户自己去点击链接才能触发XSS代码，例如对于网站W的用户U，不小心点击了一个链接，暗中将他的cookie发送到由攻击者构建的网站。受害者为少数用户；

* DOM型：取决于输出位置，并不取决于输出环境，DOM XSS 是由于浏览器解析机制导致的漏洞，服务器不参与，而存储型与反射型都需要服务器响应参与。


***CSRF***

Cross Site Request Forgery 跨站请求伪造

伪装来自受信任用户的请求来利用受信任的网站，或者说利用用户已登录的身份（cookie），伪装成用户操作。

举个例子：用户A正在XX银行的网站上进行操作，突然收到一个诱惑的图片链接，A随手一点，果然看到某日本女星的诱惑写真，可是过了一会儿收到短信提醒，已经转出1000元至B账户，这当中发生了什么？可能的方法是：B构建了一个长宽都为0的页面，并设置隐藏，当A点击图片链接时，图片加载时触发了表单提交操作（转账1000元），由于当前cookie还生效，因此提交成功。

***点击劫持***

一种视觉上的欺骗手段。大概有两种方式，一是攻击者使用一个透明的iframe，覆盖在一个网页上，然后诱使用户在该页面上进行操作，此时用户将在不知情的情况下点击透明的iframe页面；二是攻击者使用一张图片覆盖在网页，遮挡网页原有位置的含义；

tip：很多通关小游戏就是利用这些方法，让用户在玩游戏的过程中，诱导用户点击某个区域，提交信息。


***URL跳转漏洞***

利用用户信任的网站，跳转到恶意的网站。

例如，在一个看起来很常见的网址链接后加上恶意链接
```
http://mail.qq.com/......&url=http://black.com
现在很多恶意链接可以进一步伪装成短链接的形式t.cn/black，更具迷惑性。
```

查看网页源代码，找出跳转链接 url.php?url=......

几种跳转方式：
```
Header头：header("location: ".$target);

JS：<script>window.location.href=\"$target\"</script>

META标签：http-equiv="Refresh" content="5"; url=...
```

***SQL注入***
本质：数据和代码未分离，即数据当做代码来执行

怎么理解呢？举个例子，当我们忘记一个网站的密码时，不妨试试万能密码admin'--，也许就能不用密码而登录，这是为什么？这是因为服务器可能在验证用户时执行了以下语句：
```
select * from users where user_name = '$NAME' and password = '$PWD';
```

这就变成了：
```

select * from users where user_name = 'admin'-- and password = '$PWD';
```

SQL注入有两个条件：一是可以控制输入的数据；二是服务器拼接SQL执行；


***命令注入***

windows的DOS和linux的Bash有很多系统命令可以利用

如：ipconifg/net user/dir/find等

执行过程：

a. web调用可执行系统命令的函数，如PHP中的system/exec/eval等；

b. 函数或函数的参数可控；

c. 拼接注入命令；

举个例子：常用的输入网址查看ip的网页，如果输入www.baidu.com && net user，则由于&&的作用，就有可能返回系统用户信息；


***文件漏洞***

很多网站提供用户上传头像，附件等文件，也提供下载app或exe等操作，攻击者可利用这些操作实现上传webshell和木马等，或者下载web上的任意文件和代码等；

文件上传：上传php文件，在浏览器地址栏里输入执行；

文件下载：解析下载请求地址，修改并执行；

文件包含：在通过PHP的函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。利用include/require/fopen/allow_url_include等操作。

参考资料：
[2017年网络安全事件盘点](http://netsecurity.51cto.com/act/secu/2017)
[网易微专业-Web安全工程师-02.WEB安全基础](http://www.cnblogs.com/kplayer/p/8467486.html)










